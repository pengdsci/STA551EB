<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Topic 3 Running SQL in SAS and R | STA551 E-Pack: Foundations of Data Science</title>
  <meta name="description" content="The output format for this example is bookdown::gitbook." />
  <meta name="generator" content="bookdown 0.35 and GitBook 2.6.7" />

  <meta property="og:title" content="Topic 3 Running SQL in SAS and R | STA551 E-Pack: Foundations of Data Science" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="The output format for this example is bookdown::gitbook." />
  <meta name="github-repo" content="rstudio/STA551EB" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Topic 3 Running SQL in SAS and R | STA551 E-Pack: Foundations of Data Science" />
  
  <meta name="twitter:description" content="The output format for this example is bookdown::gitbook." />
  

<meta name="author" content="Cheng Peng" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="data-science---a-big-picture.html"/>
<link rel="next" href="exploratory-data-analysis-eda.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<center><li><a href="./"><font color = "darkred"><b>STA 551 E-Pack: Foundations of Data Science</b></font></a><br><font color = "navy">Cheng Peng</font></li></center>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#the-origin-of-data-science"><i class="fa fa-check"></i><b>1.1</b> The Origin of Data Science</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#the-coverage-of-the-first-data-science-course"><i class="fa fa-check"></i><b>1.2</b> The Coverage of the First Data Science Course</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#tentative-topics"><i class="fa fa-check"></i><b>1.3</b> Tentative Topics</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="data-science---a-big-picture.html"><a href="data-science---a-big-picture.html"><i class="fa fa-check"></i><b>2</b> Data Science - A Big Picture</a>
<ul>
<li class="chapter" data-level="2.1" data-path="data-science---a-big-picture.html"><a href="data-science---a-big-picture.html#data-science-process"><i class="fa fa-check"></i><b>2.1</b> Data Science Process</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="data-science---a-big-picture.html"><a href="data-science---a-big-picture.html#what-is-data"><i class="fa fa-check"></i><b>2.1.1</b> What is Data?</a></li>
<li class="chapter" data-level="2.1.2" data-path="data-science---a-big-picture.html"><a href="data-science---a-big-picture.html#data-storage-and-retrieval"><i class="fa fa-check"></i><b>2.1.2</b> Data Storage and Retrieval</a></li>
<li class="chapter" data-level="2.1.3" data-path="data-science---a-big-picture.html"><a href="data-science---a-big-picture.html#different-da-roles-in-industry"><i class="fa fa-check"></i><b>2.1.3</b> Different DA Roles in Industry</a></li>
<li class="chapter" data-level="2.1.4" data-path="data-science---a-big-picture.html"><a href="data-science---a-big-picture.html#cloud-computing"><i class="fa fa-check"></i><b>2.1.4</b> Cloud Computing</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="data-science---a-big-picture.html"><a href="data-science---a-big-picture.html#from-business-questions-to-analytic-question"><i class="fa fa-check"></i><b>2.2</b> From Business Questions to Analytic Question</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="data-science---a-big-picture.html"><a href="data-science---a-big-picture.html#business-goal"><i class="fa fa-check"></i><b>2.2.1</b> Business Goal</a></li>
<li class="chapter" data-level="2.2.2" data-path="data-science---a-big-picture.html"><a href="data-science---a-big-picture.html#analytic-question"><i class="fa fa-check"></i><b>2.2.2</b> Analytic Question</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="data-science---a-big-picture.html"><a href="data-science---a-big-picture.html#concepts-of-relational-databases-and-sql"><i class="fa fa-check"></i><b>2.3</b> Concepts of Relational Databases and SQL</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="data-science---a-big-picture.html"><a href="data-science---a-big-picture.html#what-is-database"><i class="fa fa-check"></i><b>2.3.1</b> What is Database?</a></li>
<li class="chapter" data-level="2.3.2" data-path="data-science---a-big-picture.html"><a href="data-science---a-big-picture.html#what-is-a-data-warehouse"><i class="fa fa-check"></i><b>2.3.2</b> What is a Data Warehouse?</a></li>
<li class="chapter" data-level="2.3.3" data-path="data-science---a-big-picture.html"><a href="data-science---a-big-picture.html#difference-between-database-and-data-warehouse"><i class="fa fa-check"></i><b>2.3.3</b> Difference between Database and Data Warehouse</a></li>
<li class="chapter" data-level="2.3.4" data-path="data-science---a-big-picture.html"><a href="data-science---a-big-picture.html#database-management-system-dbms"><i class="fa fa-check"></i><b>2.3.4</b> Database Management System (DBMS)</a></li>
<li class="chapter" data-level="2.3.5" data-path="data-science---a-big-picture.html"><a href="data-science---a-big-picture.html#some-definitions-and-notations-of-relational-tables"><i class="fa fa-check"></i><b>2.3.5</b> Some Definitions and Notations of Relational Tables</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="running-sql-in-sas-and-r.html"><a href="running-sql-in-sas-and-r.html"><i class="fa fa-check"></i><b>3</b> Running SQL in SAS and R</a>
<ul>
<li class="chapter" data-level="3.1" data-path="running-sql-in-sas-and-r.html"><a href="running-sql-in-sas-and-r.html#running-sql-in-sas"><i class="fa fa-check"></i><b>3.1</b> Running SQL in SAS</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="running-sql-in-sas-and-r.html"><a href="running-sql-in-sas-and-r.html#loading-data"><i class="fa fa-check"></i><b>3.1.1</b> Loading Data</a></li>
<li class="chapter" data-level="3.1.2" data-path="running-sql-in-sas-and-r.html"><a href="running-sql-in-sas-and-r.html#basic-sql-syntax-and-clauses"><i class="fa fa-check"></i><b>3.1.2</b> Basic SQL Syntax and Clauses</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="running-sql-in-sas-and-r.html"><a href="running-sql-in-sas-and-r.html#running-sas-in-r"><i class="fa fa-check"></i><b>3.2</b> Running SAS in R</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="running-sql-in-sas-and-r.html"><a href="running-sql-in-sas-and-r.html#connect-r-to-existing-database"><i class="fa fa-check"></i><b>3.2.1</b> Connect R to Existing Database</a></li>
<li class="chapter" data-level="3.2.2" data-path="running-sql-in-sas-and-r.html"><a href="running-sql-in-sas-and-r.html#create-sqlite-database-with-r"><i class="fa fa-check"></i><b>3.2.2</b> Create SQLite Database with R</a></li>
<li class="chapter" data-level="3.2.3" data-path="running-sql-in-sas-and-r.html"><a href="running-sql-in-sas-and-r.html#running-sql-queries-in-r-code-chunks"><i class="fa fa-check"></i><b>3.2.3</b> Running SQL Queries in R Code chunks</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="exploratory-data-analysis-eda.html"><a href="exploratory-data-analysis-eda.html"><i class="fa fa-check"></i><b>4</b> Exploratory Data Analysis (EDA)</a>
<ul>
<li class="chapter" data-level="4.1" data-path="exploratory-data-analysis-eda.html"><a href="exploratory-data-analysis-eda.html#tools-of-eda-and-applications"><i class="fa fa-check"></i><b>4.1</b> Tools of EDA and Applications</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="exploratory-data-analysis-eda.html"><a href="exploratory-data-analysis-eda.html#descriptive-statistics-approach"><i class="fa fa-check"></i><b>4.1.1</b> Descriptive Statistics Approach</a></li>
<li class="chapter" data-level="4.1.2" data-path="exploratory-data-analysis-eda.html"><a href="exploratory-data-analysis-eda.html#graphical-approach"><i class="fa fa-check"></i><b>4.1.2</b> Graphical Approach</a></li>
<li class="chapter" data-level="4.1.3" data-path="exploratory-data-analysis-eda.html"><a href="exploratory-data-analysis-eda.html#algorithm-based-method"><i class="fa fa-check"></i><b>4.1.3</b> Algorithm-based Method</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="exploratory-data-analysis-eda.html"><a href="exploratory-data-analysis-eda.html#visual-techniques-of-eda"><i class="fa fa-check"></i><b>4.2</b> Visual Techniques of EDA</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="exploratory-data-analysis-eda.html"><a href="exploratory-data-analysis-eda.html#univariate-eda"><i class="fa fa-check"></i><b>4.2.1</b> Univariate EDA</a></li>
<li class="chapter" data-level="4.2.2" data-path="exploratory-data-analysis-eda.html"><a href="exploratory-data-analysis-eda.html#two-variables"><i class="fa fa-check"></i><b>4.2.2</b> Two Variables</a></li>
<li class="chapter" data-level="4.2.3" data-path="exploratory-data-analysis-eda.html"><a href="exploratory-data-analysis-eda.html#three-or-more-variables"><i class="fa fa-check"></i><b>4.2.3</b> Three or More Variables</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="exploratory-data-analysis-eda.html"><a href="exploratory-data-analysis-eda.html#roles-of-visualization-in-eda"><i class="fa fa-check"></i><b>4.3</b> Roles of Visualization in EDA</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="exploratory-data-analysis-eda.html"><a href="exploratory-data-analysis-eda.html#data-visualization"><i class="fa fa-check"></i><b>4.3.1</b> Data Visualization</a></li>
<li class="chapter" data-level="4.3.2" data-path="exploratory-data-analysis-eda.html"><a href="exploratory-data-analysis-eda.html#visual-analytics"><i class="fa fa-check"></i><b>4.3.2</b> Visual Analytics</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="eda-for-feature-engineering.html"><a href="eda-for-feature-engineering.html"><i class="fa fa-check"></i><b>5</b> EDA for Feature Engineering</a>
<ul>
<li class="chapter" data-level="5.1" data-path="eda-for-feature-engineering.html"><a href="eda-for-feature-engineering.html#description-of-data"><i class="fa fa-check"></i><b>5.1</b> Description of Data</a></li>
<li class="chapter" data-level="5.2" data-path="eda-for-feature-engineering.html"><a href="eda-for-feature-engineering.html#eda-for-feature-engineering-1"><i class="fa fa-check"></i><b>5.2</b> EDA for Feature Engineering</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="eda-for-feature-engineering.html"><a href="eda-for-feature-engineering.html#missing-values---imputation"><i class="fa fa-check"></i><b>5.2.1</b> Missing Values - Imputation</a></li>
<li class="chapter" data-level="5.2.2" data-path="eda-for-feature-engineering.html"><a href="eda-for-feature-engineering.html#assess-distributions"><i class="fa fa-check"></i><b>5.2.2</b> Assess Distributions</a></li>
<li class="chapter" data-level="5.2.3" data-path="eda-for-feature-engineering.html"><a href="eda-for-feature-engineering.html#pairwise-association"><i class="fa fa-check"></i><b>5.2.3</b> Pairwise Association</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="eda-for-feature-engineering.html"><a href="eda-for-feature-engineering.html#concluding-remarks"><i class="fa fa-check"></i><b>5.3</b> Concluding Remarks</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="multiple-linear-regression.html"><a href="multiple-linear-regression.html"><i class="fa fa-check"></i><b>6</b> Multiple Linear Regression</a>
<ul>
<li class="chapter" data-level="6.1" data-path="multiple-linear-regression.html"><a href="multiple-linear-regression.html#the-practical-question"><i class="fa fa-check"></i><b>6.1</b> The Practical Question</a></li>
<li class="chapter" data-level="6.2" data-path="multiple-linear-regression.html"><a href="multiple-linear-regression.html#the-process-of-building-a-multiple-linear-regression-model"><i class="fa fa-check"></i><b>6.2</b> The Process of Building A Multiple Linear Regression Model</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="multiple-linear-regression.html"><a href="multiple-linear-regression.html#assumptions-of-mlr"><i class="fa fa-check"></i><b>6.2.1</b> Assumptions of MLR</a></li>
<li class="chapter" data-level="6.2.2" data-path="multiple-linear-regression.html"><a href="multiple-linear-regression.html#the-structure-of-mlr"><i class="fa fa-check"></i><b>6.2.2</b> The Structure of MLR</a></li>
<li class="chapter" data-level="6.2.3" data-path="multiple-linear-regression.html"><a href="multiple-linear-regression.html#more-on-model-specifications"><i class="fa fa-check"></i><b>6.2.3</b> More on Model Specifications</a></li>
<li class="chapter" data-level="6.2.4" data-path="multiple-linear-regression.html"><a href="multiple-linear-regression.html#estimation-of-regression-coefficients"><i class="fa fa-check"></i><b>6.2.4</b> Estimation of Regression Coefficients</a></li>
<li class="chapter" data-level="6.2.5" data-path="multiple-linear-regression.html"><a href="multiple-linear-regression.html#model-diagnostics"><i class="fa fa-check"></i><b>6.2.5</b> Model Diagnostics</a></li>
<li class="chapter" data-level="6.2.6" data-path="multiple-linear-regression.html"><a href="multiple-linear-regression.html#goodness-of-fit-and-variable-selection"><i class="fa fa-check"></i><b>6.2.6</b> Goodness-of-fit and Variable Selection</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="multiple-linear-regression.html"><a href="multiple-linear-regression.html#case-study-1"><i class="fa fa-check"></i><b>6.3</b> Case Study 1</a></li>
<li class="chapter" data-level="6.4" data-path="multiple-linear-regression.html"><a href="multiple-linear-regression.html#case-study-2"><i class="fa fa-check"></i><b>6.4</b> Case Study 2</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="logistic-regression-models.html"><a href="logistic-regression-models.html"><i class="fa fa-check"></i><b>7</b> Logistic Regression Models</a>
<ul>
<li class="chapter" data-level="7.1" data-path="logistic-regression-models.html"><a href="logistic-regression-models.html#motivational-example-and-practical-question"><i class="fa fa-check"></i><b>7.1</b> Motivational Example and Practical Question</a></li>
<li class="chapter" data-level="7.2" data-path="logistic-regression-models.html"><a href="logistic-regression-models.html#logistic-regression-models-and-applications"><i class="fa fa-check"></i><b>7.2</b> Logistic Regression Models and Applications</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="logistic-regression-models.html"><a href="logistic-regression-models.html#the-structure-of-the-logistic-regression-model"><i class="fa fa-check"></i><b>7.2.1</b> The Structure of the Logistic Regression Model</a></li>
<li class="chapter" data-level="7.2.2" data-path="logistic-regression-models.html"><a href="logistic-regression-models.html#assumptions-and-diagnostics"><i class="fa fa-check"></i><b>7.2.2</b> Assumptions and Diagnostics</a></li>
<li class="chapter" data-level="7.2.3" data-path="logistic-regression-models.html"><a href="logistic-regression-models.html#coefficient-estimation-and-interpretation"><i class="fa fa-check"></i><b>7.2.3</b> Coefficient Estimation and Interpretation</a></li>
<li class="chapter" data-level="7.2.4" data-path="logistic-regression-models.html"><a href="logistic-regression-models.html#use-of-glm-and-annotations"><i class="fa fa-check"></i><b>7.2.4</b> Use of <strong>glm()</strong> and Annotations</a></li>
<li class="chapter" data-level="7.2.5" data-path="logistic-regression-models.html"><a href="logistic-regression-models.html#applications-of-logistic-regression-models"><i class="fa fa-check"></i><b>7.2.5</b> Applications of Logistic Regression Models</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="logistic-regression-models.html"><a href="logistic-regression-models.html#case-studies"><i class="fa fa-check"></i><b>7.3</b> Case Studies</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="logistic-regression-models.html"><a href="logistic-regression-models.html#the-simple-logistic-regression-model"><i class="fa fa-check"></i><b>7.3.1</b> The simple logistic regression model</a></li>
<li class="chapter" data-level="7.3.2" data-path="logistic-regression-models.html"><a href="logistic-regression-models.html#multiple-logistic-regression-model"><i class="fa fa-check"></i><b>7.3.2</b> Multiple Logistic Regression Model</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="basics-of-bootstrap-method.html"><a href="basics-of-bootstrap-method.html"><i class="fa fa-check"></i><b>8</b> Basics of Bootstrap Method</a>
<ul>
<li class="chapter" data-level="8.1" data-path="basics-of-bootstrap-method.html"><a href="basics-of-bootstrap-method.html#basic-idea-of-bootstrap-method."><i class="fa fa-check"></i><b>8.1</b> Basic Idea of Bootstrap Method.</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="basics-of-bootstrap-method.html"><a href="basics-of-bootstrap-method.html#random-sample-from-population"><i class="fa fa-check"></i><b>8.1.1</b> Random Sample from Population</a></li>
<li class="chapter" data-level="8.1.2" data-path="basics-of-bootstrap-method.html"><a href="basics-of-bootstrap-method.html#bootstrap-sampling-and-bootstrap-sampling-distribution"><i class="fa fa-check"></i><b>8.1.2</b> Bootstrap Sampling and Bootstrap Sampling Distribution</a></li>
<li class="chapter" data-level="8.1.3" data-path="basics-of-bootstrap-method.html"><a href="basics-of-bootstrap-method.html#relationship-between-two-estimated-sampling-distributions"><i class="fa fa-check"></i><b>8.1.3</b> Relationship between Two Estimated Sampling Distributions</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="basics-of-bootstrap-method.html"><a href="basics-of-bootstrap-method.html#bootstrap-confidence-intervals"><i class="fa fa-check"></i><b>8.2</b> Bootstrap Confidence Intervals</a></li>
<li class="chapter" data-level="8.3" data-path="basics-of-bootstrap-method.html"><a href="basics-of-bootstrap-method.html#bootstrap-confidence-interval-of-correlation-coefficient"><i class="fa fa-check"></i><b>8.3</b> Bootstrap Confidence Interval of Correlation Coefficient</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="basics-of-bootstrap-method.html"><a href="basics-of-bootstrap-method.html#bootstrapping-data-set"><i class="fa fa-check"></i><b>8.3.1</b> Bootstrapping Data Set</a></li>
<li class="chapter" data-level="8.3.2" data-path="basics-of-bootstrap-method.html"><a href="basics-of-bootstrap-method.html#confidence-interval-of-coefficient-correlation"><i class="fa fa-check"></i><b>8.3.2</b> Confidence Interval of Coefficient Correlation</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="method-of-cross-validation.html"><a href="method-of-cross-validation.html"><i class="fa fa-check"></i><b>9</b> Method of Cross-Validation</a>
<ul>
<li class="chapter" data-level="9.1" data-path="method-of-cross-validation.html"><a href="method-of-cross-validation.html#regression-models"><i class="fa fa-check"></i><b>9.1</b> Regression Models</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="method-of-cross-validation.html"><a href="method-of-cross-validation.html#linear-regression-model"><i class="fa fa-check"></i><b>9.1.1</b> Linear Regression Model</a></li>
<li class="chapter" data-level="9.1.2" data-path="method-of-cross-validation.html"><a href="method-of-cross-validation.html#logistic-regression-model"><i class="fa fa-check"></i><b>9.1.2</b> Logistic Regression Model</a></li>
<li class="chapter" data-level="9.1.3" data-path="method-of-cross-validation.html"><a href="method-of-cross-validation.html#inference-about-association-and-prediction"><i class="fa fa-check"></i><b>9.1.3</b> Inference about Association and Prediction</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="method-of-cross-validation.html"><a href="method-of-cross-validation.html#data-splitting-methods"><i class="fa fa-check"></i><b>9.2</b> Data Splitting Methods</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="method-of-cross-validation.html"><a href="method-of-cross-validation.html#training-data"><i class="fa fa-check"></i><b>9.2.1</b> Training Data</a></li>
<li class="chapter" data-level="9.2.2" data-path="method-of-cross-validation.html"><a href="method-of-cross-validation.html#validation-data"><i class="fa fa-check"></i><b>9.2.2</b> Validation Data</a></li>
<li class="chapter" data-level="9.2.3" data-path="method-of-cross-validation.html"><a href="method-of-cross-validation.html#test-data"><i class="fa fa-check"></i><b>9.2.3</b> Test data</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="method-of-cross-validation.html"><a href="method-of-cross-validation.html#cross-validation"><i class="fa fa-check"></i><b>9.3</b> Cross-validation</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="method-of-cross-validation.html"><a href="method-of-cross-validation.html#k-fold-cross-validation"><i class="fa fa-check"></i><b>9.3.1</b> K-fold Cross-validation</a></li>
<li class="chapter" data-level="9.3.2" data-path="method-of-cross-validation.html"><a href="method-of-cross-validation.html#other-cross-validation-methods"><i class="fa fa-check"></i><b>9.3.2</b> Other Cross-Validation Methods</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="method-of-cross-validation.html"><a href="method-of-cross-validation.html#case-study-using-fraud-data"><i class="fa fa-check"></i><b>9.4</b> Case Study Using Fraud Data</a>
<ul>
<li class="chapter" data-level="9.4.1" data-path="method-of-cross-validation.html"><a href="method-of-cross-validation.html#data-partition"><i class="fa fa-check"></i><b>9.4.1</b> Data Partition</a></li>
<li class="chapter" data-level="9.4.2" data-path="method-of-cross-validation.html"><a href="method-of-cross-validation.html#finding-optimal-cut-off-probability"><i class="fa fa-check"></i><b>9.4.2</b> Finding Optimal Cut-off Probability</a></li>
<li class="chapter" data-level="9.4.3" data-path="method-of-cross-validation.html"><a href="method-of-cross-validation.html#reporting-test"><i class="fa fa-check"></i><b>9.4.3</b> Reporting Test</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="method-of-cross-validation.html"><a href="method-of-cross-validation.html#concluding-remarks-1"><i class="fa fa-check"></i><b>9.5</b> Concluding Remarks</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="perfomance-measures-of-algorithms-and-models.html"><a href="perfomance-measures-of-algorithms-and-models.html"><i class="fa fa-check"></i><b>10</b> Perfomance Measures of Algorithms and Models</a></li>
<li class="chapter" data-level="11" data-path="classification-performance-metrics.html"><a href="classification-performance-metrics.html"><i class="fa fa-check"></i><b>11</b> Classification Performance Metrics</a>
<ul>
<li class="chapter" data-level="11.1" data-path="classification-performance-metrics.html"><a href="classification-performance-metrics.html#confusion-matrix-for-binary-decision"><i class="fa fa-check"></i><b>11.1</b> Confusion Matrix for Binary Decision</a></li>
<li class="chapter" data-level="11.2" data-path="classification-performance-metrics.html"><a href="classification-performance-metrics.html#local-performance-measures-for-model-development"><i class="fa fa-check"></i><b>11.2</b> Local Performance Measures (for Model Development)</a></li>
<li class="chapter" data-level="11.3" data-path="classification-performance-metrics.html"><a href="classification-performance-metrics.html#global-performance-measures"><i class="fa fa-check"></i><b>11.3</b> Global Performance Measures</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="case-study---logistic-regression-model-with-the-fraud-data.html"><a href="case-study---logistic-regression-model-with-the-fraud-data.html"><i class="fa fa-check"></i><b>12</b> Case Study - Logistic regression model with the fraud data</a>
<ul>
<li class="chapter" data-level="12.1" data-path="case-study---logistic-regression-model-with-the-fraud-data.html"><a href="case-study---logistic-regression-model-with-the-fraud-data.html#local-performance-meaures"><i class="fa fa-check"></i><b>12.1</b> Local Performance Meaures</a></li>
<li class="chapter" data-level="12.2" data-path="case-study---logistic-regression-model-with-the-fraud-data.html"><a href="case-study---logistic-regression-model-with-the-fraud-data.html#global-measure-roc-and-auc"><i class="fa fa-check"></i><b>12.2</b> Global Measure: ROC and AUC</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="from-statistics-models-to-machine-learning-algorithms.html"><a href="from-statistics-models-to-machine-learning-algorithms.html"><i class="fa fa-check"></i><b>13</b> From Statistics Models to Machine Learning Algorithms</a>
<ul>
<li class="chapter" data-level="13.1" data-path="from-statistics-models-to-machine-learning-algorithms.html"><a href="from-statistics-models-to-machine-learning-algorithms.html#some-technical-terms-and-ml-types"><i class="fa fa-check"></i><b>13.1</b> Some Technical Terms and ML Types</a>
<ul>
<li class="chapter" data-level="13.1.1" data-path="from-statistics-models-to-machine-learning-algorithms.html"><a href="from-statistics-models-to-machine-learning-algorithms.html#machine-learning-problems-and-jargon"><i class="fa fa-check"></i><b>13.1.1</b> Machine Learning Problems and Jargon</a></li>
<li class="chapter" data-level="13.1.2" data-path="from-statistics-models-to-machine-learning-algorithms.html"><a href="from-statistics-models-to-machine-learning-algorithms.html#types-of-machine-learning-problems"><i class="fa fa-check"></i><b>13.1.2</b> Types of Machine Learning Problems</a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="from-statistics-models-to-machine-learning-algorithms.html"><a href="from-statistics-models-to-machine-learning-algorithms.html#categories-of-machine-learning"><i class="fa fa-check"></i><b>13.2</b> Categories of Machine Learning</a>
<ul>
<li class="chapter" data-level="13.2.1" data-path="from-statistics-models-to-machine-learning-algorithms.html"><a href="from-statistics-models-to-machine-learning-algorithms.html#supervised-learning"><i class="fa fa-check"></i><b>13.2.1</b> Supervised Learning</a></li>
<li class="chapter" data-level="13.2.2" data-path="from-statistics-models-to-machine-learning-algorithms.html"><a href="from-statistics-models-to-machine-learning-algorithms.html#unsupervised-learning"><i class="fa fa-check"></i><b>13.2.2</b> Unsupervised Learning</a></li>
<li class="chapter" data-level="13.2.3" data-path="from-statistics-models-to-machine-learning-algorithms.html"><a href="from-statistics-models-to-machine-learning-algorithms.html#semi-supervised-learning"><i class="fa fa-check"></i><b>13.2.3</b> Semi-Supervised Learning</a></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="from-statistics-models-to-machine-learning-algorithms.html"><a href="from-statistics-models-to-machine-learning-algorithms.html#from-statistics-to-machine-learning"><i class="fa fa-check"></i><b>13.3</b> From Statistics to Machine Learning</a>
<ul>
<li class="chapter" data-level="13.3.1" data-path="from-statistics-models-to-machine-learning-algorithms.html"><a href="from-statistics-models-to-machine-learning-algorithms.html#logistic-regression-model-revisited"><i class="fa fa-check"></i><b>13.3.1</b> Logistic Regression Model Revisited</a></li>
<li class="chapter" data-level="13.3.2" data-path="from-statistics-models-to-machine-learning-algorithms.html"><a href="from-statistics-models-to-machine-learning-algorithms.html#single-layer-neural-network---perceptron"><i class="fa fa-check"></i><b>13.3.2</b> Single Layer Neural Network - Perceptron</a></li>
<li class="chapter" data-level="13.3.3" data-path="from-statistics-models-to-machine-learning-algorithms.html"><a href="from-statistics-models-to-machine-learning-algorithms.html#multi-layer-perceptron"><i class="fa fa-check"></i><b>13.3.3</b> Multi-layer Perceptron</a></li>
<li class="chapter" data-level="13.3.4" data-path="from-statistics-models-to-machine-learning-algorithms.html"><a href="from-statistics-models-to-machine-learning-algorithms.html#commonly-used-activation-functions"><i class="fa fa-check"></i><b>13.3.4</b> Commonly Used Activation Functions</a></li>
<li class="chapter" data-level="13.3.5" data-path="from-statistics-models-to-machine-learning-algorithms.html"><a href="from-statistics-models-to-machine-learning-algorithms.html#algorithms-for-estimating-weights"><i class="fa fa-check"></i><b>13.3.5</b> Algorithms for Estimating Weights</a></li>
</ul></li>
<li class="chapter" data-level="13.4" data-path="from-statistics-models-to-machine-learning-algorithms.html"><a href="from-statistics-models-to-machine-learning-algorithms.html#implementing-nn-with-r"><i class="fa fa-check"></i><b>13.4</b> Implementing NN with R</a>
<ul>
<li class="chapter" data-level="13.4.1" data-path="from-statistics-models-to-machine-learning-algorithms.html"><a href="from-statistics-models-to-machine-learning-algorithms.html#syntax-of-neuralnet"><i class="fa fa-check"></i><b>13.4.1</b> Syntax of <code>neuralnet</code></a></li>
<li class="chapter" data-level="13.4.2" data-path="from-statistics-models-to-machine-learning-algorithms.html"><a href="from-statistics-models-to-machine-learning-algorithms.html#feature-conversion-for-neuralnet"><i class="fa fa-check"></i><b>13.4.2</b> Feature Conversion for <code>neuralnet</code></a></li>
<li class="chapter" data-level="13.4.3" data-path="from-statistics-models-to-machine-learning-algorithms.html"><a href="from-statistics-models-to-machine-learning-algorithms.html#numeric-feature-scaling"><i class="fa fa-check"></i><b>13.4.3</b> Numeric Feature Scaling</a></li>
<li class="chapter" data-level="13.4.4" data-path="from-statistics-models-to-machine-learning-algorithms.html"><a href="from-statistics-models-to-machine-learning-algorithms.html#extract-all-feature-names"><i class="fa fa-check"></i><b>13.4.4</b> Extract All Feature Names</a></li>
<li class="chapter" data-level="13.4.5" data-path="from-statistics-models-to-machine-learning-algorithms.html"><a href="from-statistics-models-to-machine-learning-algorithms.html#define-model-formula"><i class="fa fa-check"></i><b>13.4.5</b> Define Model Formula</a></li>
<li class="chapter" data-level="13.4.6" data-path="from-statistics-models-to-machine-learning-algorithms.html"><a href="from-statistics-models-to-machine-learning-algorithms.html#training-and-testing-nn-model"><i class="fa fa-check"></i><b>13.4.6</b> Training and Testing NN Model</a></li>
<li class="chapter" data-level="13.4.7" data-path="from-statistics-models-to-machine-learning-algorithms.html"><a href="from-statistics-models-to-machine-learning-algorithms.html#about-deep-learning"><i class="fa fa-check"></i><b>13.4.7</b> About Deep Learning</a></li>
</ul></li>
<li class="chapter" data-level="13.5" data-path="from-statistics-models-to-machine-learning-algorithms.html"><a href="from-statistics-models-to-machine-learning-algorithms.html#clustering-algorithms"><i class="fa fa-check"></i><b>13.5</b> Clustering Algorithms</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">STA551 E-Pack: Foundations of Data Science</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="running-sql-in-sas-and-r" class="section level1 hasAnchor" number="3">
<h1><span class="header-section-number">Topic 3</span> Running SQL in SAS and R<a href="running-sql-in-sas-and-r.html#running-sql-in-sas-and-r" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Although R and Python has different data wrangling libraries we can use to connect to databases for information extraction. Structural Query Language (SQL) is native to different DBMS. Some degree of proficiency in SQL crucial for every data professional.</p>
<p>This note use SAS PROX SQL and several R packages to run SQL in SAS and R.</p>
<div id="running-sql-in-sas" class="section level2 hasAnchor" number="3.1">
<h2><span class="header-section-number">3.1</span> Running SQL in SAS<a href="running-sql-in-sas-and-r.html#running-sql-in-sas" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The PROC SQL in SAS is powerful. We can run authentic SQL script with in SAS SQL. One can use free SAS Studio via SAS on-Demand. We will use three relational data tables in the following SAS code (URLs are also in the SAS code).</p>
<p>In order to make the code workable in SAS environment, we simply copy and paste the code to include it in this note. NOte that, SAS converted imported relational tables to SAS data sets. The resulting tables in PROC SAS are still SAS tables stored in the designated library. If a library reference is not given, the resulting SAS data set will be saved in the temporary library.</p>
<div id="loading-data" class="section level3 hasAnchor" number="3.1.1">
<h3><span class="header-section-number">3.1.1</span> Loading Data<a href="running-sql-in-sas-and-r.html#loading-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<pre><code>LIBNAME sql &quot;/home/u50445699/STA551&quot;;

filename dat01 url &#39;https://pengdsci.github.io/datasets/AnimalSurvey/plots.csv&#39;;
filename dat02 url &#39;https://pengdsci.github.io/datasets/AnimalSurvey/species.csv&#39;;
filename dat03 url &#39;https://pengdsci.github.io/datasets/AnimalSurvey/surveys.csv&#39;;

*write a macro to load multiple data files;
%MACRO IMPORTCSV(in_csv, out_sas);
PROC IMPORT DATAFILE=&amp;in_csv 
   DBMS=csv 
   OUT=sql.&amp;out_sas 
   REPLACE;
RUN;
%MEND;

*call macros to load data files;
%IMPORTCSV(dat01, plots);
%IMPORTCSV(dat02, species);
%IMPORTCSV(dat03, survey);
</code></pre>
</div>
<div id="basic-sql-syntax-and-clauses" class="section level3 hasAnchor" number="3.1.2">
<h3><span class="header-section-number">3.1.2</span> Basic SQL Syntax and Clauses<a href="running-sql-in-sas-and-r.html#basic-sql-syntax-and-clauses" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>####. First query with clause SELECT</p>
<p>(a). Create a table view</p>
<p>(b). Create a new table (SAS data set)</p>
<pre><code>*Table view;   
PROC SQL;
/** The actual SQL code starts here **/
SELECT year
FROM sql.survey;
/***/
QUIT;


* create a new table;
PROC SQL;

CREATE TABLE sql.YMD AS
SELECT year, 
       month, 
       day
FROM sql.survey;

QUIT;

* create a new table: select all variables;
PROC SQL;

CREATE TABLE sql.survey_all AS
SELECT *
FROM sql.survey;

QUIT;</code></pre>
<p><strong>CAUTION</strong>: SQL uses “CREATE VIEW name_of_table AS” to
create a view table that is saved in the database and
can be used to look at, filter, and even update information.</p>
<div id="select-unique-values" class="section level4 hasAnchor" number="3.1.2.1">
<h4><span class="header-section-number">3.1.2.1</span> Select unique values<a href="running-sql-in-sas-and-r.html#select-unique-values" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<pre><code>* one variable;
PROC SQL;
SELECT DISTINCT year
FROM sql.survey;
QUIT;

* two variable;
PROC SQL;
SELECT DISTINCT year, 
                species_id
FROM sql.survey;
QUIT;</code></pre>
</div>
<div id="calculated-values" class="section level4 hasAnchor" number="3.1.2.2">
<h4><span class="header-section-number">3.1.2.2</span> Calculated values<a href="running-sql-in-sas-and-r.html#calculated-values" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<pre><code>* Create a view;
PROC SQL;
SELECT year, 
       month, 
       day, 
       INPUT(weight, best.)/1000.0 AS wgt
FROM sql.survey;
QUIT;

* Create a table and define a new variable
  based on the calculated values;
PROC SQL;
CREATE TABLE sql.Add_new_var AS
SELECT year, 
       month, 
       day, 
       INPUT(weight, best.)/1000.0 AS wt_kilo
FROM sql.survey;
QUIT;


proc contents data = sql.surveys; run;

                         
PROC SQL;
SELECT plot_id, 
       species_id, 
       sex, 
       weight, 
       ROUND(INPUT(weight, best.)/ 1000.0, 0.01) /* ROUND() is a SAS function! */
FROM sql.survey;
QUIT;</code></pre>
</div>
<div id="filtering" class="section level4 hasAnchor" number="3.1.2.3">
<h4><span class="header-section-number">3.1.2.3</span> Filtering<a href="running-sql-in-sas-and-r.html#filtering" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<pre><code>* subsetting by filtering - WHERE statement;
* Single condition;
PROC SQL;
SELECT *
FROM sql.survey
WHERE species_id=&#39;DM&#39;;
QUIT;


* Multiple conditions: AND;
PROC SQL;
SELECT *
FROM sql.survey
WHERE (year &gt;= 2000) AND (species_id = &#39;DM&#39;);
QUIT;

* Multiple conditions: OR;
PROC SQL;
SELECT *
FROM sql.survey
WHERE (species_id = &#39;DM&#39;) OR (species_id = &#39;DO&#39;) OR (species_id = &#39;DS&#39;);
QUIT;</code></pre>
</div>
<div id="special-keywords-simplify-where-statement" class="section level4 hasAnchor" number="3.1.2.4">
<h4><span class="header-section-number">3.1.2.4</span> Special Keywords simplify WHERE statement<a href="running-sql-in-sas-and-r.html#special-keywords-simplify-where-statement" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<pre><code>* use of keyword IN;
PROC SQL;
SELECT *
FROM sql.survey
WHERE (year &gt;= 2000) AND (species_id IN (&#39;DM&#39;, &#39;DO&#39;, &#39;DS&#39;));
QUIT;</code></pre>
</div>
<div id="sorting-variables" class="section level4 hasAnchor" number="3.1.2.5">
<h4><span class="header-section-number">3.1.2.5</span> Sorting Variables<a href="running-sql-in-sas-and-r.html#sorting-variables" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<pre><code>* Ascending ordering - default;
PROC SQL;
SELECT *
FROM sql.species
ORDER BY taxa ASC;
QUIT;

* descending ordering;
PROC SQL;
SELECT *
FROM sql.species
ORDER BY taxa DESC;
QUIT;

* sorting multiple variables- nest sorting;
PROC SQL;
SELECT *
FROM sql.species
ORDER BY genus ASC, species ASC;
QUIT;</code></pre>
</div>
<div id="order-of-execution" class="section level4 hasAnchor" number="3.1.2.6">
<h4><span class="header-section-number">3.1.2.6</span> Order of Execution<a href="running-sql-in-sas-and-r.html#order-of-execution" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<pre><code>*Clauses are written in a fixed order: SELECT, FROM, WHERE, then ORDER BY. ;
PROC SQL;
SELECT genus, species
FROM sql.species
WHERE taxa = &#39;Bird&#39;
ORDER BY species_id ASC;
QUIT;</code></pre>
</div>
<div id="summary-statistics-with-groups" class="section level4 hasAnchor" number="3.1.2.7">
<h4><span class="header-section-number">3.1.2.7</span> Summary Statistics with groups<a href="running-sql-in-sas-and-r.html#summary-statistics-with-groups" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<pre><code>*no group - Using the wildcard simply counts the number of records (rows);
PROC SQL;
SELECT COUNT(*)
FROM sql.survey;
QUIT;

* calculate the sum of a numerical variable;
PROC SQL;
SELECT COUNT(*) ,
       SUM(INPUT(weight, best.))
FROM sql.survey;
QUIT;

* calculate the sum of a numerical variable - adding names of summary statistics;
PROC SQL;
SELECT COUNT(*) AS sample_size,
       SUM(weight) AS total_weight
FROM sql.survey;
QUIT;

*summary statistics within subgroups - GROUP BY clause;
* This is equalent to a univeriable frequency table;
PROC SQL;
SELECT species_id, 
       COUNT(*)
FROM sql.survey
GROUP BY species_id;
QUIT;</code></pre>
</div>
<div id="having-clause-based-on-aggregated-variables" class="section level4 hasAnchor" number="3.1.2.8">
<h4><span class="header-section-number">3.1.2.8</span> HAVING clause based on aggregated variables<a href="running-sql-in-sas-and-r.html#having-clause-based-on-aggregated-variables" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<pre><code>* conditioning on species size;
PROC SQL;
SELECT species_id, 
       COUNT(species_id)
FROM sql.survey
GROUP BY species_id
HAVING COUNT(species_id) &gt; 10;
QUIT;

* conditioning on species size - a better code;
PROC SQL;
SELECT species_id, 
       COUNT(species_id) AS species_size
FROM sql.survey
GROUP BY species_id
HAVING species_size &gt; 10;
QUIT;</code></pre>
</div>
<div id="ordering-aggregated-results." class="section level4 hasAnchor" number="3.1.2.9">
<h4><span class="header-section-number">3.1.2.9</span> Ordering aggregated results.<a href="running-sql-in-sas-and-r.html#ordering-aggregated-results." class="anchor-section" aria-label="Anchor link to header"></a></h4>
<pre><code>* sorting aggregated variables -- This DOES NOT work!
* Summary functions are restricted to the SELECT and HAVING clauses only;
PROC SQL;
SELECT species_id, 
       COUNT(*) 
FROM sql.survey
GROUP BY species_id
ORDER BY COUNT(species_id);
QUIT;

* sorting aggregated variables;
* use the new name in the ORDER BY clause;
PROC SQL;
SELECT species_id AS subtotal, 
       COUNT(*) 
FROM sql.survey
GROUP BY species_id
ORDER BY subtotal;
QUIT;</code></pre>
</div>
<div id="null---working-with-missing-values" class="section level4 hasAnchor" number="3.1.2.10">
<h4><span class="header-section-number">3.1.2.10</span> NULL - Working with Missing values<a href="running-sql-in-sas-and-r.html#null---working-with-missing-values" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<pre><code>* keyword IS;
PROC SQL;
SELECT *
FROM sql.survey
WHERE species_id IS NULL;
QUIT;

* keyword IS NOT;
PROC SQL;
SELECT *
FROM sql.survey
WHERE species_id IS NOT NULL;
QUIT;

* for non-missing values, we use IS/IS NOT or =/!=;
* CAUTION: &quot;=&quot; and &quot;==&quot; both work in SQL, However, &quot;==&quot; does NOT in SAS.;
PROC SQL;
SELECT SUM(INPUT(weight, best.)), 
       COUNT(*), 
       SUM(INPUT(weight, best.))/COUNT(*)
FROM sql.survey
WHERE species_id = &#39;PE&#39;;
QUIT;

* for non-missing values, we use IS/IS NOT or =/!=;
* CAUTION: &quot;=&quot; and &quot;==&quot; both work in SQL, However, &quot;==&quot; does NOT in SAS.;
* != works in SQL, but not in SAS. ^= works in SAS;
PROC SQL;
SELECT SUM(INPUT(weight, best.)), 
       COUNT(*), 
       SUM(INPUT(weight, best.))/COUNT(*)
FROM sql.survey
WHERE species_id ^= &#39;PE&#39;;
QUIT;</code></pre>
</div>
<div id="working-with-multiple-tables-join" class="section level4 hasAnchor" number="3.1.2.11">
<h4><span class="header-section-number">3.1.2.11</span> Working with multiple tables: JOIN<a href="running-sql-in-sas-and-r.html#working-with-multiple-tables-join" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<pre><code>*INNER JOIN;
*Need to use ALIAS to rename/name the data set since
 the files are stored in the SAS permanent libaray;
PROC SQL;
SELECT *
FROM sql.survey AS surveys
JOIN sql.species AS species
ON surveys.species_id = species.species_id;
QUIT;


* we can simply rename the tables as A and B using alias;
PROC SQL;
CREATE TABLE sql.INNERJOIN AS
SELECT *
FROM sql.survey AS A
JOIN sql.species AS B
ON A.species_id = B.species_id;
QUIT;

*left join;
PROC SQL;
CREATE TABLE sql.LEFTJOIN AS
SELECT *
FROM sql.survey AS A
LEFT JOIN sql.species AS B
ON A.species_id = B.species_id;
QUIT;

*right join;
PROC SQL;
CREATE TABLE sql.RIGHTJOIN AS
SELECT *
FROM sql.survey AS A
RIGHT JOIN sql.species AS B
ON A.species_id = B.species_id;
QUIT;

*full join;
PROC SQL;
CREATE TABLE sql.FULLTJOIN AS
SELECT *
FROM sql.survey AS A
FULL JOIN sql.species AS B
ON A.species_id = B.species_id;
QUIT;

* We can select some variables from individual tables
* then join the two sub tables.;
* CAUTION: We will NOT select any variables in species table 
*  to include in the new table;
PROC SQL;
SELECT A.species_id, 
       A.sex, 
       AVG(INPUT(a.hindfoot_length, best.)) as mean_foot_length  
FROM sql.survey  AS A
JOIN sql.species AS B
ON A.species_id=B.species_id 
WHERE taxa = &#39;Rodent&#39; AND A.sex IS NOT NULL 
GROUP BY A.species_id, A.sex;
QUIT;</code></pre>
</div>
<div id="creatng-new-variables" class="section level4 hasAnchor" number="3.1.2.12">
<h4><span class="header-section-number">3.1.2.12</span> Creatng New Variables<a href="running-sql-in-sas-and-r.html#creatng-new-variables" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The following code defines new variables using string functions in SQL. This method is sometimes used to define composite keys</p>
<pre><code>PROC SQL;
SELECT *, 
       species_id||&#39;-&#39;||sex AS newKey
FROM sql.surveys;
QUIT;</code></pre>
</div>
<div id="nest-queries" class="section level4 hasAnchor" number="3.1.2.13">
<h4><span class="header-section-number">3.1.2.13</span> Nest Queries<a href="running-sql-in-sas-and-r.html#nest-queries" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<pre><code>* nest queries;
* The SELECT ... FROM in the denominator is self-contained
* It is NOT affected by GROUP BY statement. The COUNT() function
* returns the total size of the data;
PROC SQL;
SELECT B.taxa, 
       100.0*COUNT(*)/(SELECT COUNT(*) FROM sql.survey)  AS Percentage
FROM sql.survey AS A
JOIN sql.species AS B
ON A.species_id = B.species_id 
GROUP BY taxa;
QUIT;</code></pre>
</div>
</div>
</div>
<div id="running-sas-in-r" class="section level2 hasAnchor" number="3.2">
<h2><span class="header-section-number">3.2</span> Running SAS in R<a href="running-sql-in-sas-and-r.html#running-sas-in-r" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>To run SQL clauses in R, we need to use several R libraries (installed and loaded in the above R setup code chunk). There are different ways to run SQL query in R. We only introduce one methods that is close to the authentic SQL code that can be run a DBMS.</p>
<div id="connect-r-to-existing-database" class="section level3 hasAnchor" number="3.2.1">
<h3><span class="header-section-number">3.2.1</span> Connect R to Existing Database<a href="running-sql-in-sas-and-r.html#connect-r-to-existing-database" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>If there is an existing database, the following code connects R to the database.</p>
<pre><code>con &lt;- DBI::dbConnect(drv = odbc::odbc(),
                      Driver = &quot;driver_name&quot;,
                      Server = &quot;server_url&quot;,
                      Database = &quot;database_name&quot;,
                      user = &quot;user&quot;, #optional
                      password = &quot;password&quot;) #optional</code></pre>
<p>This section shows the three basic steps to run SQL in R using R Markdown starting with a set of relational tables.</p>
<ol style="list-style-type: decimal">
<li><p>Load relational data tables as usual to R.</p></li>
<li><p>Create a SQLite (relational) database that contain these relational table.</p></li>
<li><p>Create R code chunk and connect to the created database using Chunk options.</p></li>
</ol>
</div>
<div id="create-sqlite-database-with-r" class="section level3 hasAnchor" number="3.2.2">
<h3><span class="header-section-number">3.2.2</span> Create SQLite Database with R<a href="running-sql-in-sas-and-r.html#create-sqlite-database-with-r" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>If modeling requires a data set that contains information from multiple relational data tables, we need to perform data management to aggregate the required information from different data tables. We can load the different data sets in different formats using appropriate R functions.</p>
<p>As an example, We use three ecological survey data sets to create a database.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="running-sql-in-sas-and-r.html#cb17-1" tabindex="-1"></a><span class="co">#Load the sample data</span></span>
<span id="cb17-2"><a href="running-sql-in-sas-and-r.html#cb17-2" tabindex="-1"></a>plots <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;https://pengdsci.github.io/datasets/AnimalSurvey/plots.csv&quot;</span>)</span>
<span id="cb17-3"><a href="running-sql-in-sas-and-r.html#cb17-3" tabindex="-1"></a>species <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;https://pengdsci.github.io/datasets/AnimalSurvey/species.csv&quot;</span>)</span>
<span id="cb17-4"><a href="running-sql-in-sas-and-r.html#cb17-4" tabindex="-1"></a>surveys <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;https://pengdsci.github.io/datasets/AnimalSurvey/surveys.csv&quot;</span>)</span></code></pre></div>
<p>Next, we create a SQLit database using several R libraries.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="running-sql-in-sas-and-r.html#cb18-1" tabindex="-1"></a><span class="co">#Create database</span></span>
<span id="cb18-2"><a href="running-sql-in-sas-and-r.html#cb18-2" tabindex="-1"></a>con <span class="ot">&lt;-</span> <span class="fu">dbConnect</span>(<span class="at">drv =</span> <span class="fu">SQLite</span>(),</span>
<span id="cb18-3"><a href="running-sql-in-sas-and-r.html#cb18-3" tabindex="-1"></a>                 <span class="at">dbname =</span> <span class="st">&quot;:memory:&quot;</span>)</span>
<span id="cb18-4"><a href="running-sql-in-sas-and-r.html#cb18-4" tabindex="-1"></a></span>
<span id="cb18-5"><a href="running-sql-in-sas-and-r.html#cb18-5" tabindex="-1"></a><span class="co">#store sample data in database</span></span>
<span id="cb18-6"><a href="running-sql-in-sas-and-r.html#cb18-6" tabindex="-1"></a><span class="fu">dbWriteTable</span>(<span class="at">conn =</span> con, </span>
<span id="cb18-7"><a href="running-sql-in-sas-and-r.html#cb18-7" tabindex="-1"></a>             <span class="at">name =</span> <span class="st">&quot;plots&quot;</span>,</span>
<span id="cb18-8"><a href="running-sql-in-sas-and-r.html#cb18-8" tabindex="-1"></a>             <span class="at">value =</span> plots)</span>
<span id="cb18-9"><a href="running-sql-in-sas-and-r.html#cb18-9" tabindex="-1"></a></span>
<span id="cb18-10"><a href="running-sql-in-sas-and-r.html#cb18-10" tabindex="-1"></a><span class="fu">dbWriteTable</span>(<span class="at">conn =</span> con, </span>
<span id="cb18-11"><a href="running-sql-in-sas-and-r.html#cb18-11" tabindex="-1"></a>             <span class="at">name =</span> <span class="st">&quot;species&quot;</span>,</span>
<span id="cb18-12"><a href="running-sql-in-sas-and-r.html#cb18-12" tabindex="-1"></a>             <span class="at">value =</span> species)</span>
<span id="cb18-13"><a href="running-sql-in-sas-and-r.html#cb18-13" tabindex="-1"></a></span>
<span id="cb18-14"><a href="running-sql-in-sas-and-r.html#cb18-14" tabindex="-1"></a><span class="fu">dbWriteTable</span>(<span class="at">conn =</span> con, </span>
<span id="cb18-15"><a href="running-sql-in-sas-and-r.html#cb18-15" tabindex="-1"></a>             <span class="at">name =</span> <span class="st">&quot;surveys&quot;</span>,</span>
<span id="cb18-16"><a href="running-sql-in-sas-and-r.html#cb18-16" tabindex="-1"></a>             <span class="at">value =</span> surveys)</span>
<span id="cb18-17"><a href="running-sql-in-sas-and-r.html#cb18-17" tabindex="-1"></a> </span>
<span id="cb18-18"><a href="running-sql-in-sas-and-r.html#cb18-18" tabindex="-1"></a><span class="co">#remove the local data from the environment</span></span>
<span id="cb18-19"><a href="running-sql-in-sas-and-r.html#cb18-19" tabindex="-1"></a><span class="fu">rm</span>(plots, species, surveys)</span></code></pre></div>
<p>We can use table view function <code>tbl()</code> to explore the information of relational data tables in the database. Note that, we</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="running-sql-in-sas-and-r.html#cb19-1" tabindex="-1"></a><span class="fu">tbl</span>(<span class="at">src =</span> con, <span class="co">#the source if the database connection profile</span></span>
<span id="cb19-2"><a href="running-sql-in-sas-and-r.html#cb19-2" tabindex="-1"></a>    <span class="fu">c</span>(<span class="st">&quot;surveys&quot;</span>)) <span class="co">#the name of the table to preview</span></span></code></pre></div>
<pre><code>## # Source:   table&lt;surveys&gt; [?? x 10]
## # Database: sqlite 3.41.2 [:memory:]
##        X record_id month   day  year plot_id species_id sex   hindfoot_length weight
##    &lt;int&gt;     &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;   &lt;int&gt; &lt;chr&gt;      &lt;chr&gt;           &lt;int&gt;  &lt;int&gt;
##  1     1         1     7    16  1977       2 NL         M                  32     NA
##  2     2         2     7    16  1977       3 NL         M                  33     NA
##  3     3         3     7    16  1977       2 DM         F                  37     NA
##  4     4         4     7    16  1977       7 DM         M                  36     NA
##  5     5         5     7    16  1977       3 DM         M                  35     NA
##  6     6         6     7    16  1977       1 PF         M                  14     NA
##  7     7         7     7    16  1977       2 PE         F                  NA     NA
##  8     8         8     7    16  1977       1 DM         M                  37     NA
##  9     9         9     7    16  1977       1 DM         F                  34     NA
## 10    10        10     7    16  1977       6 PF         F                  20     NA
## # ℹ more rows</code></pre>
</div>
<div id="running-sql-queries-in-r-code-chunks" class="section level3 hasAnchor" number="3.2.3">
<h3><span class="header-section-number">3.2.3</span> Running SQL Queries in R Code chunks<a href="running-sql-in-sas-and-r.html#running-sql-queries-in-r-code-chunks" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>To use SQL in RMarkdown, we need the following chunk options:</p>
<ol style="list-style-type: decimal">
<li>sql</li>
<li>connection = “database-name”</li>
<li>output.var = “output-dataset-name”</li>
</ol>
<p>If we create a data view only, we simply ignore option <code>output.var =</code></p>
<p>Following are few examples of SQL queries based on the animal survey data tales in the database.</p>
<div id="subsetting-and-duplicating-data" class="section level4 hasAnchor" number="3.2.3.1">
<h4><span class="header-section-number">3.2.3.1</span> Subsetting and Duplicating Data<a href="running-sql-in-sas-and-r.html#subsetting-and-duplicating-data" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ol style="list-style-type: decimal">
<li>Extract year, month and day from <code>survey</code> table</li>
</ol>
<div class="sourceCode" id="cb21"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb21-1"><a href="running-sql-in-sas-and-r.html#cb21-1" tabindex="-1"></a><span class="kw">SELECT</span> </span>
<span id="cb21-2"><a href="running-sql-in-sas-and-r.html#cb21-2" tabindex="-1"></a>  surveys.<span class="dt">year</span>, surveys.<span class="dt">month</span>, surveys.<span class="dt">Day</span></span>
<span id="cb21-3"><a href="running-sql-in-sas-and-r.html#cb21-3" tabindex="-1"></a><span class="kw">FROM</span> </span>
<span id="cb21-4"><a href="running-sql-in-sas-and-r.html#cb21-4" tabindex="-1"></a> surveys <span class="co">/* pointer is not needed since it is in the database */</span></span>
<span id="cb21-5"><a href="running-sql-in-sas-and-r.html#cb21-5" tabindex="-1"></a><span class="kw">WHERE</span></span>
<span id="cb21-6"><a href="running-sql-in-sas-and-r.html#cb21-6" tabindex="-1"></a>  surveys.species_id <span class="kw">IN</span> (<span class="st">&#39;NL&#39;</span>, <span class="st">&#39;DM&#39;</span>) <span class="kw">AND</span></span>
<span id="cb21-7"><a href="running-sql-in-sas-and-r.html#cb21-7" tabindex="-1"></a>  surveys.sex <span class="op">=</span> <span class="st">&#39;M&#39;</span></span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Duplicate a data and rename it</li>
</ol>
<div class="sourceCode" id="cb22"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb22-1"><a href="running-sql-in-sas-and-r.html#cb22-1" tabindex="-1"></a><span class="kw">SELECT</span> </span>
<span id="cb22-2"><a href="running-sql-in-sas-and-r.html#cb22-2" tabindex="-1"></a>  surveys.<span class="op">*</span></span>
<span id="cb22-3"><a href="running-sql-in-sas-and-r.html#cb22-3" tabindex="-1"></a><span class="kw">FROM</span> </span>
<span id="cb22-4"><a href="running-sql-in-sas-and-r.html#cb22-4" tabindex="-1"></a> surveys</span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Create a table view (i.e., no data set will be created and saved)</li>
</ol>
<div class="sourceCode" id="cb23"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb23-1"><a href="running-sql-in-sas-and-r.html#cb23-1" tabindex="-1"></a><span class="kw">SELECT</span> </span>
<span id="cb23-2"><a href="running-sql-in-sas-and-r.html#cb23-2" tabindex="-1"></a>  surveys.<span class="dt">year</span>, surveys.<span class="dt">month</span>, surveys.<span class="dt">Day</span></span>
<span id="cb23-3"><a href="running-sql-in-sas-and-r.html#cb23-3" tabindex="-1"></a><span class="kw">FROM</span> </span>
<span id="cb23-4"><a href="running-sql-in-sas-and-r.html#cb23-4" tabindex="-1"></a> surveys</span>
<span id="cb23-5"><a href="running-sql-in-sas-and-r.html#cb23-5" tabindex="-1"></a><span class="kw">WHERE</span></span>
<span id="cb23-6"><a href="running-sql-in-sas-and-r.html#cb23-6" tabindex="-1"></a>  surveys.species_id <span class="op">=</span> <span class="st">&#39;NL&#39;</span> <span class="kw">AND</span></span>
<span id="cb23-7"><a href="running-sql-in-sas-and-r.html#cb23-7" tabindex="-1"></a>  surveys.sex <span class="op">=</span> <span class="st">&#39;M&#39;</span></span></code></pre></div>
</div>
<div id="define-a-new-variable" class="section level4 hasAnchor" number="3.2.3.2">
<h4><span class="header-section-number">3.2.3.2</span> Define A New Variable<a href="running-sql-in-sas-and-r.html#define-a-new-variable" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ol style="list-style-type: decimal">
<li>Define a new variable with simple arithmetic operations</li>
</ol>
<div class="sourceCode" id="cb24"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb24-1"><a href="running-sql-in-sas-and-r.html#cb24-1" tabindex="-1"></a><span class="kw">SELECT</span> </span>
<span id="cb24-2"><a href="running-sql-in-sas-and-r.html#cb24-2" tabindex="-1"></a>    surveys.plot_id, </span>
<span id="cb24-3"><a href="running-sql-in-sas-and-r.html#cb24-3" tabindex="-1"></a>    surveys.species_id, </span>
<span id="cb24-4"><a href="running-sql-in-sas-and-r.html#cb24-4" tabindex="-1"></a>    surveys.sex, </span>
<span id="cb24-5"><a href="running-sql-in-sas-and-r.html#cb24-5" tabindex="-1"></a>    surveys.weight, </span>
<span id="cb24-6"><a href="running-sql-in-sas-and-r.html#cb24-6" tabindex="-1"></a>    surveys.weight<span class="op">/</span><span class="dv">100</span> <span class="kw">AS</span> wt_kilo  <span class="co">/*should not the pointer in front of the name of the new variable*/</span> </span>
<span id="cb24-7"><a href="running-sql-in-sas-and-r.html#cb24-7" tabindex="-1"></a><span class="kw">FROM</span> </span>
<span id="cb24-8"><a href="running-sql-in-sas-and-r.html#cb24-8" tabindex="-1"></a>   surveys</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Define new variables using string functions in SQL</li>
</ol>
<div class="sourceCode" id="cb25"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb25-1"><a href="running-sql-in-sas-and-r.html#cb25-1" tabindex="-1"></a><span class="kw">SELECT</span> surveys.<span class="op">*</span>, </span>
<span id="cb25-2"><a href="running-sql-in-sas-and-r.html#cb25-2" tabindex="-1"></a>       surveys.species_id<span class="op">||</span><span class="st">&#39;-&#39;</span><span class="op">||</span>surveys.sex <span class="kw">AS</span> newKey</span>
<span id="cb25-3"><a href="running-sql-in-sas-and-r.html#cb25-3" tabindex="-1"></a><span class="kw">FROM</span> surveys</span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Define new variables with aggregated information</li>
</ol>
<div class="sourceCode" id="cb26"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb26-1"><a href="running-sql-in-sas-and-r.html#cb26-1" tabindex="-1"></a><span class="kw">SELECT</span> surveys.species_id, </span>
<span id="cb26-2"><a href="running-sql-in-sas-and-r.html#cb26-2" tabindex="-1"></a>       <span class="fu">COUNT</span>(surveys.species_id) <span class="kw">AS</span> species_ctr</span>
<span id="cb26-3"><a href="running-sql-in-sas-and-r.html#cb26-3" tabindex="-1"></a><span class="kw">FROM</span> surveys</span>
<span id="cb26-4"><a href="running-sql-in-sas-and-r.html#cb26-4" tabindex="-1"></a><span class="kw">GROUP</span> <span class="kw">BY</span> surveys.species_id</span>
<span id="cb26-5"><a href="running-sql-in-sas-and-r.html#cb26-5" tabindex="-1"></a><span class="kw">HAVING</span> species_ctr <span class="op">&gt;</span> <span class="dv">10</span></span></code></pre></div>
</div>
<div id="sorting-variables-1" class="section level4 hasAnchor" number="3.2.3.3">
<h4><span class="header-section-number">3.2.3.3</span> Sorting Variables<a href="running-sql-in-sas-and-r.html#sorting-variables-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ol style="list-style-type: decimal">
<li>Sort data based on the summarized statistics of a variable</li>
</ol>
<p>Summary functions are restricted to the SELECT and HAVING clauses only;</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb27-1"><a href="running-sql-in-sas-and-r.html#cb27-1" tabindex="-1"></a><span class="kw">SELECT</span> surveys.species_id</span>
<span id="cb27-2"><a href="running-sql-in-sas-and-r.html#cb27-2" tabindex="-1"></a><span class="kw">FROM</span> surveys</span>
<span id="cb27-3"><a href="running-sql-in-sas-and-r.html#cb27-3" tabindex="-1"></a><span class="kw">GROUP</span> <span class="kw">BY</span> surveys.species_id</span>
<span id="cb27-4"><a href="running-sql-in-sas-and-r.html#cb27-4" tabindex="-1"></a><span class="kw">ORDER</span> <span class="kw">BY</span> <span class="fu">COUNT</span>(surveys.species_id);</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Sort data based on a new variable defined using summarized statistics of a variable.</li>
</ol>
<div class="sourceCode" id="cb28"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb28-1"><a href="running-sql-in-sas-and-r.html#cb28-1" tabindex="-1"></a><span class="co">/* create a table view*/</span></span>
<span id="cb28-2"><a href="running-sql-in-sas-and-r.html#cb28-2" tabindex="-1"></a><span class="kw">SELECT</span> surveys.species_id <span class="kw">AS</span> subtotal, </span>
<span id="cb28-3"><a href="running-sql-in-sas-and-r.html#cb28-3" tabindex="-1"></a>       <span class="fu">COUNT</span>(<span class="op">*</span>) </span>
<span id="cb28-4"><a href="running-sql-in-sas-and-r.html#cb28-4" tabindex="-1"></a><span class="kw">FROM</span> surveys</span>
<span id="cb28-5"><a href="running-sql-in-sas-and-r.html#cb28-5" tabindex="-1"></a><span class="kw">GROUP</span> <span class="kw">BY</span> surveys.species_id</span>
<span id="cb28-6"><a href="running-sql-in-sas-and-r.html#cb28-6" tabindex="-1"></a><span class="kw">ORDER</span> <span class="kw">BY</span> subtotal;</span></code></pre></div>
</div>
<div id="join-tables" class="section level4 hasAnchor" number="3.2.3.4">
<h4><span class="header-section-number">3.2.3.4</span> Join Tables<a href="running-sql-in-sas-and-r.html#join-tables" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>This section introduce commonly used join operation to merge tables using the common key(s).</p>
<ol style="list-style-type: decimal">
<li>Inner Join</li>
</ol>
<div class="sourceCode" id="cb29"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb29-1"><a href="running-sql-in-sas-and-r.html#cb29-1" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span></span>
<span id="cb29-2"><a href="running-sql-in-sas-and-r.html#cb29-2" tabindex="-1"></a><span class="kw">FROM</span> surveys <span class="kw">AS</span> A</span>
<span id="cb29-3"><a href="running-sql-in-sas-and-r.html#cb29-3" tabindex="-1"></a><span class="kw">JOIN</span> species <span class="kw">AS</span> B</span>
<span id="cb29-4"><a href="running-sql-in-sas-and-r.html#cb29-4" tabindex="-1"></a><span class="kw">ON</span> A.species_id <span class="op">=</span> B.species_id;</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Left Join</li>
</ol>
<div class="sourceCode" id="cb30"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb30-1"><a href="running-sql-in-sas-and-r.html#cb30-1" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span></span>
<span id="cb30-2"><a href="running-sql-in-sas-and-r.html#cb30-2" tabindex="-1"></a><span class="kw">FROM</span> surveys <span class="kw">AS</span> A</span>
<span id="cb30-3"><a href="running-sql-in-sas-and-r.html#cb30-3" tabindex="-1"></a><span class="kw">LEFT</span> <span class="kw">JOIN</span> species <span class="kw">AS</span> B</span>
<span id="cb30-4"><a href="running-sql-in-sas-and-r.html#cb30-4" tabindex="-1"></a><span class="kw">ON</span> A.species_id <span class="op">=</span> B.species_id;</span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Right Join</li>
</ol>
<div class="sourceCode" id="cb31"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb31-1"><a href="running-sql-in-sas-and-r.html#cb31-1" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span></span>
<span id="cb31-2"><a href="running-sql-in-sas-and-r.html#cb31-2" tabindex="-1"></a><span class="kw">FROM</span> surveys <span class="kw">AS</span> A</span>
<span id="cb31-3"><a href="running-sql-in-sas-and-r.html#cb31-3" tabindex="-1"></a><span class="kw">RIGHT</span> <span class="kw">JOIN</span> species <span class="kw">AS</span> B</span>
<span id="cb31-4"><a href="running-sql-in-sas-and-r.html#cb31-4" tabindex="-1"></a><span class="kw">ON</span> A.species_id <span class="op">=</span> B.species_id;</span></code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li>Full Join</li>
</ol>
<div class="sourceCode" id="cb32"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb32-1"><a href="running-sql-in-sas-and-r.html#cb32-1" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span></span>
<span id="cb32-2"><a href="running-sql-in-sas-and-r.html#cb32-2" tabindex="-1"></a><span class="kw">FROM</span> surveys <span class="kw">AS</span> A</span>
<span id="cb32-3"><a href="running-sql-in-sas-and-r.html#cb32-3" tabindex="-1"></a><span class="kw">FULL</span> <span class="kw">JOIN</span> species <span class="kw">AS</span> B</span>
<span id="cb32-4"><a href="running-sql-in-sas-and-r.html#cb32-4" tabindex="-1"></a><span class="kw">ON</span> A.species_id <span class="op">=</span> B.species_id;</span></code></pre></div>
<ol start="5" style="list-style-type: decimal">
<li>Join sub-tables</li>
</ol>
<div class="sourceCode" id="cb33"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb33-1"><a href="running-sql-in-sas-and-r.html#cb33-1" tabindex="-1"></a><span class="kw">SELECT</span> A.species_id, </span>
<span id="cb33-2"><a href="running-sql-in-sas-and-r.html#cb33-2" tabindex="-1"></a>       A.sex, </span>
<span id="cb33-3"><a href="running-sql-in-sas-and-r.html#cb33-3" tabindex="-1"></a>       <span class="fu">AVG</span>(A.weight) <span class="kw">as</span> mean_wgt  </span>
<span id="cb33-4"><a href="running-sql-in-sas-and-r.html#cb33-4" tabindex="-1"></a><span class="kw">FROM</span> surveys <span class="kw">AS</span> A</span>
<span id="cb33-5"><a href="running-sql-in-sas-and-r.html#cb33-5" tabindex="-1"></a><span class="kw">JOIN</span> species <span class="kw">AS</span> B</span>
<span id="cb33-6"><a href="running-sql-in-sas-and-r.html#cb33-6" tabindex="-1"></a><span class="kw">ON</span> A.species_id<span class="op">=</span>B.species_id </span>
<span id="cb33-7"><a href="running-sql-in-sas-and-r.html#cb33-7" tabindex="-1"></a><span class="kw">WHERE</span> taxa <span class="op">=</span> <span class="st">&#39;Rodent&#39;</span> <span class="kw">AND</span> A.sex <span class="kw">IS</span> <span class="kw">NOT</span> <span class="kw">NULL</span> </span>
<span id="cb33-8"><a href="running-sql-in-sas-and-r.html#cb33-8" tabindex="-1"></a><span class="kw">GROUP</span> <span class="kw">BY</span> A.species_id, A.sex; </span></code></pre></div>
</div>
<div id="subqueries" class="section level4 hasAnchor" number="3.2.3.5">
<h4><span class="header-section-number">3.2.3.5</span> Subqueries<a href="running-sql-in-sas-and-r.html#subqueries" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ol style="list-style-type: decimal">
<li>Sample size</li>
</ol>
<div class="sourceCode" id="cb34"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb34-1"><a href="running-sql-in-sas-and-r.html#cb34-1" tabindex="-1"></a><span class="kw">SELECT</span> <span class="fu">COUNT</span>(<span class="op">*</span>) </span>
<span id="cb34-2"><a href="running-sql-in-sas-and-r.html#cb34-2" tabindex="-1"></a><span class="kw">FROM</span> surveys</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Relative Frequency with sub-query</li>
</ol>
<div class="sourceCode" id="cb35"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb35-1"><a href="running-sql-in-sas-and-r.html#cb35-1" tabindex="-1"></a><span class="kw">SELECT</span> B.taxa, </span>
<span id="cb35-2"><a href="running-sql-in-sas-and-r.html#cb35-2" tabindex="-1"></a>       <span class="fl">100.0</span><span class="op">*</span><span class="fu">COUNT</span>(<span class="op">*</span>)<span class="op">/</span>(<span class="kw">SELECT</span> <span class="fu">COUNT</span>(<span class="op">*</span>) <span class="kw">FROM</span> surveys)  <span class="kw">AS</span> Percentage</span>
<span id="cb35-3"><a href="running-sql-in-sas-and-r.html#cb35-3" tabindex="-1"></a><span class="kw">FROM</span> surveys <span class="kw">AS</span> A</span>
<span id="cb35-4"><a href="running-sql-in-sas-and-r.html#cb35-4" tabindex="-1"></a><span class="kw">JOIN</span> species <span class="kw">AS</span> B</span>
<span id="cb35-5"><a href="running-sql-in-sas-and-r.html#cb35-5" tabindex="-1"></a><span class="kw">ON</span> A.species_id <span class="op">=</span> B.species_id </span>
<span id="cb35-6"><a href="running-sql-in-sas-and-r.html#cb35-6" tabindex="-1"></a><span class="kw">GROUP</span> <span class="kw">BY</span> taxa;</span></code></pre></div>

<p><br />
</p>
</div>
</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="data-science---a-big-picture.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="exploratory-data-analysis-eda.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/pengdsci/STA551EB/edit/master/02-BasicSQL.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["STA551EB.pdf", "STA551EB.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
